
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>STEAM Class Chat (Secure Login)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 900px;
    }
    #loginScreen, #chatUI, #setupPasswordUI, #changePasswordUI, #resetPasswordUI {
      display:none;
    }
    #chatBox {
      height: 420px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      background:#fafafa;
    }
    .message {
      margin-bottom:8px;
      padding:4px 6px;
      border-radius:4px;
    }
    .own {
      background:#e6f7ff;
    }
    .meta {
      color:gray;
      font-size:0.85em;
      margin-left:8px;
    }
    .smallBtn {
      padding:4px 6px;
      font-size:0.85em;
      margin-left:6px;
    }
    #modalOverlay {
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      display:none;
      justify-content:center;
      align-items:center;
    }
    #modalBox {
      background:white;
      padding:20px;
      border-radius:8px;
      width:90%;
      max-width:500px;
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
    }
    .unread-indicator {
      background-color: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 0.75em;
      margin-left: 6px;
    }
  </style>
</head>
<body>
  <h2>STEAM Chat</h2>
  <div id="loginScreen">
    <h3>Sign In</h3>
    <p>Enter your name and password.</p>
    <input id="username" placeholder="First Last" style="width:60%;padding:8px;"><br><br>
    <input id="password" type="password" placeholder="Password" style="width:60%;padding:8px;"><br><br>
    <button id="loginBtn">Login</button>
    <button id="forgotBtn" style="margin-left:10px;">Forgot Password?</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <div id="setupPasswordUI">
    <h3>Create a New Password</h3>
    <p>Welcome! Set a password for your account.</p>
    <input id="newPassword" type="password" placeholder="Enter new password" style="width:60%;padding:8px;"><br><br>
    <button id="saveNewPasswordBtn">Save Password</button>
    <p id="setupError" style="color:red;"></p>
  </div>

  <div id="changePasswordUI">
    <h3>Change Your Password</h3>
    <p>Enter your current password and new password.</p>
    <input id="currentPass" type="password" placeholder="Current password" style="width:60%;padding:8px;"><br><br>
    <input id="newPassChange" type="password" placeholder="New password" style="width:60%;padding:8px;"><br><br>
    <button id="changePassBtn">Change Password</button>
    <button id="cancelChangeBtn">Cancel</button>
    <p id="changeError" style="color:red;"></p>
  </div>

  <div id="chatUI">
    <p>Signed in as: <strong id="currentUser"></strong>
      <button id="logoutBtn" class="smallBtn">Logout</button>
      <button id="changePasswordLink" class="smallBtn">Change Password</button>
    </p>
    <div id="resetPasswordUI">
      <h4>Manager Controls</h4>
      <input id="resetUser" placeholder="User to reset" style="width:50%;padding:6px;">
      <button id="resetPassBtn">Reset User Password</button>
      <p id="resetMsg" style="color:green;"></p>
    </div>
    <div id="rooms">
      <h3>Your Rooms <span id="roomsUnreadIndicator" class="unread-indicator" style="display:none;"></span></h3>
      <select id="roomSelect" style="width:60%;"></select>
      <button id="createRoomBtn">Create Private Room</button>
      <button id="viewMembersBtn">View Members</button>
      <button id="deleteRoomBtn" style="display:none;">Delete Room</button>
    </div>
    <div id="chatContainer" style="margin-top:20px;">
      <h3 id="roomTitle">Room</h3>
      <div id="chatBox"></div>
      <div style="margin-top:8px;">
        <input id="messageInput" placeholder="Type your message..." style="width:78%;padding:8px;">
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <div id="modalOverlay">
    <div id="modalBox">
      <h3>Create Private Room</h3>
      <label>Room Name:</label>
      <input id="newRoomName" style="width:100%;padding:6px;"><br><br>
      <div id="studentList" style="max-height:200px;overflow-y:auto;border:1px solid #ccc;padding:6px;"></div><br>
      <button id="confirmCreateRoom">Create</button>
      <button id="cancelCreateRoom">Cancel</button>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase config and initialization
    const firebaseConfig = {
      apiKey: "AIzaSyC3q0jqh2zfzKXwHyA6wjPe_dL5t5CGds0",
      authDomain: "steam-chat-82c10.firebaseapp.com",
      projectId: "steam-chat-82c10",
      storageBucket: "steam-chat-82c10.appspot.com",
      messagingSenderId: "527558016185",
      appId: "1:527558016185:web:33473cb2098cad5e812f68",
      measurementId: "G-Z6ENYE5ES8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // The rest of the JavaScript logic including:
    // - User authentication
    // - Room loading and message listening
    // - Unread message tracking via 'readBy' field
    // - Displaying unread indicators
    // - Manager controls for deleting rooms
    // - Viewing room members

    // Due to size constraints, the full JavaScript logic will be continued in a separate file or section.
  </script>
</body>
</html>
