<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>STEAM Class Chat (Secure Login)</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
#loginScreen, #chatUI, #setupPasswordUI, #changePasswordUI, #resetPasswordUI { display:none; }
#chatBox { height: 420px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background:#fafafa; }
.message { margin-bottom:8px; padding:4px 6px; border-radius:4px; }
.own { background:#e6f7ff; }
.meta { color:gray; font-size:0.85em; margin-left:8px; }
.smallBtn { padding:4px 6px; font-size:0.85em; margin-left:6px; }
#modalOverlay, #membersModal { display:none; position: fixed; top:0; left:0; width:100%; height:100%; justify-content:center; align-items:center; background: rgba(0,0,0,0.5); }
#modalBox, #membersModal div { background:white; padding:20px; border-radius:8px; width:90%; max-width:500px; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
#membersList { max-height:300px; overflow-y:auto; list-style:none; padding-left:0; }
</style>
</head>
<body>
<h2>STEAM Chat</h2>

<!-- ===== Login Screens ===== -->
<div id="loginScreen">
  <h3>Sign In</h3>
  <p>Enter your name and password (or any password if first time to set it up).</p>
  <input id="username" placeholder="First Last" style="width:60%;padding:8px;"><br><br>
  <input id="password" type="password" placeholder="Password" style="width:60%;padding:8px;"><br><br>
  <button id="loginBtn">Login</button>
  <button id="forgotBtn" style="margin-left:10px;">Forgot Password?</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="setupPasswordUI">
  <h3>Create a New Password</h3>
  <input id="newPassword" type="password" placeholder="Enter new password" style="width:60%;padding:8px;"><br><br>
  <button id="saveNewPasswordBtn">Save Password</button>
  <p id="setupError" style="color:red;"></p>
</div>

<div id="changePasswordUI">
  <h3>Change Your Password</h3>
  <input id="currentPass" type="password" placeholder="Current password" style="width:60%;padding:8px;"><br><br>
  <input id="newPassChange" type="password" placeholder="New password" style="width:60%;padding:8px;"><br><br>
  <button id="changePassBtn">Change Password</button>
  <button id="cancelChangeBtn">Cancel</button>
  <p id="changeError" style="color:red;"></p>
</div>

<!-- ===== Chat UI ===== -->
<div id="chatUI">
  <p>Signed in as: <strong id="currentUser"></strong> 
    <button id="logoutBtn" class="smallBtn">Logout</button> 
    <button id="changePasswordLink" class="smallBtn">Change Password</button>
  </p>

  <div id="resetPasswordUI">
    <h4>Manager Controls</h4>
    <input id="resetUser" placeholder="User to reset" style="width:50%;padding:6px;">
    <button id="resetPassBtn">Reset User Password</button>
    <p id="resetMsg" style="color:green;"></p>
  </div>

  <div id="rooms">
    <h3>Your Rooms</h3>
    <select id="roomSelect" style="width:60%;"></select>
    <button id="createRoomBtn">Create Private Room</button>
    <button id="viewMembersBtn" class="smallBtn">View Members</button>
    <button id="deleteRoomBtn" class="smallBtn" style="background:red;color:white;">Delete Current Room</button>
  </div>

  <div id="chatContainer" style="margin-top:20px;">
    <h3 id="roomTitle">Room</h3>
    <div id="chatBox"></div>
    <div style="margin-top:8px;">
      <input id="messageInput" placeholder="Type your message..." style="width:78%;padding:8px;">
      <button id="sendBtn">Send</button>
    </div>
  </div>
</div>

<!-- ===== Private Room Modal ===== -->
<div id="modalOverlay">
  <div id="modalBox">
    <h3>Create Private Room</h3>
    <label>Room Name:</label>
    <input id="newRoomName" style="width:100%;padding:6px;"><br><br>
    <div id="studentList" style="max-height:200px;overflow-y:auto;border:1px solid #ccc;padding:6px;"></div><br>
    <button id="confirmCreateRoom">Create</button>
    <button id="cancelCreateRoom">Cancel</button>
  </div>
</div>

<!-- ===== Members Modal ===== -->
<div id="membersModal">
  <div>
    <h3>Room Members</h3>
    <ul id="membersList"></ul>
    <button id="closeMembersModal">Close</button>
  </div>
</div>

<!-- ===== Firebase ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyC3q0jqh2zfzKXwHyA6wjPe_dL5t5CGds0",
  authDomain: "steam-chat-82c10.firebaseapp.com",
  projectId: "steam-chat-82c10",
  storageBucket: "steam-chat-82c10.firebasestorage.app",
  messagingSenderId: "527558016185",
  appId: "1:527558016185:web:33473cb2098cad5e812f68",
  measurementId: "G-Z6ENYE5ES8"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const students = [
  { name: "Brycen Gallardo" }, { name: "Liam Pendergast" }, { name: "Samuel Prather" }, 
  { name: "Zayden Tenney" }, { name: "Ammon Rhoten" }, { name: "Arthur Hagge" }, 
  { name: "Caleb Clark" }, { name: "Charlotte Young" }, { name: "David Graham" },
  { name: "Easton Aker" }, { name: "Elijah Conti" }, { name: "Emelia Hulse" },
  { name: "Ethan Hawkins" }, { name: "Fox Eisinger" }, { name: "Hans Holland" },
  { name: "Jackson Holcombe" }, { name: "Joseph Brown" }, { name: "Kate Russell" },
  { name: "Leah Wilson" }, { name: "Lincoln LaMarr" }, { name: "Spencer Nielson" },
  { name: "Torin Castle" }, { name: "Victor Peters" }
];
const managers = ["Brycen Gallardo","Liam Pendergast","Samuel Prather","Zayden Tenney"];

const loginScreen = document.getElementById("loginScreen");
const chatUI = document.getElementById("chatUI");
const setupPasswordUI = document.getElementById("setupPasswordUI");
const changePasswordUI = document.getElementById("changePasswordUI");
const resetPasswordUI = document.getElementById("resetPasswordUI");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const forgotBtn = document.getElementById("forgotBtn");
const currentUserEl = document.getElementById("currentUser");
const logoutBtn = document.getElementById("logoutBtn");
const createRoomBtn = document.getElementById("createRoomBtn");
const roomSelect = document.getElementById("roomSelect");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const chatBox = document.getElementById("chatBox");
const roomTitle = document.getElementById("roomTitle");
const modalOverlay = document.getElementById("modalOverlay");
const membersModal = document.getElementById("membersModal");
const membersList = document.getElementById("membersList");
const closeMembersModal = document.getElementById("closeMembersModal");
const viewMembersBtn = document.getElementById("viewMembersBtn");
const deleteRoomBtn = document.getElementById("deleteRoomBtn");

let currentUser=null, isManager=false, currentRoomId=null;

function showLogin(){ loginScreen.style.display="block"; chatUI.style.display="none"; }
function showChat(){ loginScreen.style.display="none"; chatUI.style.display="block"; resetPasswordUI.style.display=isManager?"block":"none"; }

// Basic local login mock (so UI loads)
function checkLocalLogin(){
  const saved=localStorage.getItem("steamUser");
  if(saved){ currentUser=saved; isManager=managers.includes(currentUser); currentUserEl.textContent=currentUser; showChat(); }
  else showLogin();
}

loginBtn.onclick=()=>{
  const name=usernameInput.value.trim();
  const pass=passwordInput.value.trim();
  if(!name)return alert("Enter your name");
  currentUser=name;
  localStorage.setItem("steamUser",name);
  isManager=managers.includes(name);
  currentUserEl.textContent=name;
  showChat();
};

logoutBtn.onclick=()=>{localStorage.removeItem("steamUser");showLogin();};

// Simple members modal (Google Sites-safe)
viewMembersBtn.onclick=async()=>{
  membersList.innerHTML="<li>Example Member 1</li><li>Example Member 2</li>";
  membersModal.style.display="flex";
};
closeMembersModal.onclick=()=>membersModal.style.display="none";

deleteRoomBtn.onclick=()=>alert("Room deleted (manager only demo)");

checkLocalLogin();
</script>
</body>
</html>
